# rnaquant
A pipeline for simple and efficient processing of eukaryotic RNA-Seq. 

## Author
[Alexander Predeus](https://www.researchgate.net/profile/Alexander_Predeus)

(c) 2015-2018, GPL v3 license

## Motivation
RNA-seq processing includes multiple steps, with best practices often varying between different species and laboratories. This pipeline deals with quality control, alignment, visualization, and quantification of bacterial RNA-seq experiments. 

When successfully applied, this should generate:
* genomic bam files for read-resolution visualization and analysis;
* TDF files for visualization in IGV;
* automatic estimation of strand-specificity; 
* three expression tables - from [featureCounts](http://subread.sourceforge.net/), [rsem](https://deweylab.github.io/RSEM/), and [kallisto](https://pachterlab.github.io/kallisto/); 

## Installation and requirements 
Clone the pipeline scripts into your home directory and add them to $PATH variable in bash: 

```bash
cd ~
git clone https://github.com/apredeus/rnaquant
echo "export ~/rnaquant:$PATH" >> .bashrc
```

To install the requirements, use [Bioconda](https://bioconda.github.io/). These are the programs that need to be installed: 

```bash
conda install fastqc
conda install star
conda install samtools
conda install bedtools
conda install igvtools
conda install rsem
conda install kallisto
conda install subread
```

You also need to have Perl installed. Sorry. 

## Reference preparation
In order to start using the pipeline, you would need two things: a genomic *fasta* file, and genome annotation in *gtf* format. 

After you have procured the *fasta* and the *gff3* and selected a (writeable) reference directory, simply run 

`prepare_bacpipe_reference.sh <reference_dir> <tag> <name>.gff <name>.fa`

or 

`prepare_bacpipe_reference.sh <reference_dir> <tag> <name>.gff` 

for Prokka-style GFF file.

## One-command RNA-seq processing
After all the references are successfully created, simply run 

`bacpipe.sh <reference_dir> <tag> <CPUs>`

Bacpipe needs to be ran in a writeable directory with fastqs folder in it. 

Bacpipe:
* handles archived (.gz) and non-archived fastq files; 
* handles single-end and paired-end reads; 
* automatically detects strand-specificity of the experiment; 
* performs quantification according to the calculated parameters. 

The following steps are performed during the pipeline execution: 
* FastQC is ran on all of the fastq files; 
* bowtie2 is used to align the fastq files to the rRNA and tRNA reference to accurately estimate rRNA/tRNA content; 
* bowtie2 is used to align the fastq files to the genomic reference using --very-sensitive-local mode;
* sam alignments are filtered by quality (q10), sorted, converted to bam, and indexed; 
* tdf files are prepared for visualization in IGV; 
* bigWig (bw) files are prepared for vizualization in majority of other genomic browsers; 
* featureCounts is ran on genomic bam to evaluate the strandedness of the experiment; 
* strandedness and basic alignment statistics are calculated; 
* featureCounts output is chosen based correct settings of strandedness; 
* rsem is ran for EM-based quantification; 
* kallisto is ran to validate the RSEM results; 
* appropriately formatted logs are generated; 
* multiqc is ran to summarize everything as a nicely formatted report. 
    
In the end you are expected to obtain a number of new directories: FastQC, bams, tdfs_and_bws, RSEM, kallisto, stats, strand, featureCounts, exp_tables. Each directory would contain the files generated by its namesake, as well as all appropriate logs. The executed commands with all of the versions and exact options are recorded in the master log. 
    
    
